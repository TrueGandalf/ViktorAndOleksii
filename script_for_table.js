var currentLeftX,currentRightX,currentMax,currentMin,allLeftX,allRightX,leftXvalue,rightXvalue,minYvalue,maxYvalue,arrForInfo,arrForInfoY,isMagnified,savedBottomGraphMouseXstart,savedBottomGraphMouseXend,justRedraw,oldAllGraphsInGroup,oldChecksArr,saveScopeTopBottom,saveTopBottom,arrayX=[],arrayY=[],ordinatArrays=[],allGraphsInGroup=[],checksArr=[!0,!0,!0,!0],dates={};function radioSelect(){let a=document.getElementsByName("graph");for(var b=0;b<a.length;b++)if(a[b].checked)return+a[b].value}function buildGraphic(a,b,c,d){a||(isMagnified=!1),arrayX.length=0,arrayY.length=0,null==allGraphsInGroup.columns&&changeGraphsInGroup(),ordinatArrays=[],ordinatArrays=allGraphsInGroup.columns.slice(1).map(a=>a.slice(1));let e=ordinatArrays[0];arrayX=allGraphsInGroup.columns[0].slice(1),leftXvalue=arrayX[0],rightXvalue=arrayX[arrayX.length-1];let f=[],g=[];for(let e=0;e<ordinatArrays.length;e++)f.push(getMaximumValue(leftXvalue,rightXvalue,"nothing",ordinatArrays[e])),g.push(getMinimumValue(leftXvalue,rightXvalue,"nothing",ordinatArrays[e]));maxYvalue=Math.max(...f),minYvalue=Math.min(...g);let h=maxYvalue-minYvalue;return(maxYvalue+=.01*h,minYvalue-=.01*h,b)?[maxYvalue,minYvalue]:void(saveTopBottom=[maxYvalue,minYvalue],(c||d)&&(maxYvalue=c,minYvalue=d),a||showGraphic(maxYvalue,minYvalue,void 0,void 0,e,"graphic"),showGraphic(maxYvalue,minYvalue,void 0,void 0,e,"summaryGraphic"))}function showGraphic(a,b,c,d,e,f){document.getElementById(f).width=document.getElementById(f).width;var g=document.getElementById(f),h=g.getContext("2d"),j=document.getElementById(f).width,k=document.getElementById(f).height;let l=!1;if(!c&&0!==c){var c=window.arrayX[0];l=!0}if(!d&&0!==d){var d=arrayX[arrayX.length-1];d=1.02*(d-c)+c}l&&(c-=.02*((d-c)/1.02));let m=!1;if(!b){var n=Math.min.apply(Math,e);m=!0}else var n=b;if(!a){var o=Math.max.apply(Math,e);o=1.04*(o-n)+n}else var o=a;m&&(n-=.04*((o-n)/1.04));var p=arrayX[arrayX.length-1]-window.arrayX[0],q=o-n;if(!(c-d)||!(o-n))return;currentLeftX=c,currentRightX=d,currentMax=o,currentMin=n,"graphic"==f?drawLines(h,k,j,c,d-c,d,q,n):(allRightX=d,allLeftX=c),"graphic"==f&&(arrForInfoY=[]);let r=[];for(let g=0;g<checksArr.length;g++)checksArr[g]&&r.push(g);for(let g=0;g<ordinatArrays.length;g++)currentColor=allGraphsInGroup.colors[`y${r[g]}`],drawGraphic(h,k,j,c,p,d,q,n,ordinatArrays[g],currentColor)}function drawLines(a,b,c,d,e,f,g,h){var i=yBlackLinesStep(e),j=d%i;{a.moveTo(0,0),a.lineTo(c,0),a.moveTo(0,b),a.lineTo(c,b);var k=yBlackLinesStep(g),l=h%k;a.strokeStyle="grey",a.stroke(),a.beginPath()}a.font="bold 15px Arial";var m,n=3,o=Math.floor(e/i);a.fillStyle="grey";let p="";for(var q=0;q<=o+1;q++){m=q*i-j;let f;dates[+(+m+d).toFixed(0)]||(f=new Date(+(+m+d).toFixed(0)).toLocaleString("en-US",{month:"short",day:"numeric"}),dates[+(+m+d).toFixed(0)]=f),f=dates[+(+m+d).toFixed(0)],f==p?f="":p=f,a.fillText(f,(q*i-j)/e*c+-20-5*(f.length-5),b-n)}a.strokeStyle="grey",a.stroke(),a.beginPath();for(var r,s=Math.floor(g/k),t=1;t<=s+1;t++)r=t*k-l,a.fillText((1*r+h).toFixed(precision(k)),0+n,b-(t*k-l)/g*b-n),a.moveTo(0,b-(t*k-l)/g*b),a.lineTo(c,b-(t*k-l)/g*b);a.strokeStyle="#888",a.stroke(),a.beginPath()}function drawGraphic(a,b,c,d,e,f,g,h,i,j){arrForInfo=[];for(var k=-666,l=0,m=1;m<c;m++)l=Math.floor(m/(c-1)*(i.length-1)),l!==k&&(a.lineTo(m*e/(f-d)+(arrayX[0]-d)/(f-d)*c,b-((i[Math.floor(m/(c-1)*(i.length-1))]-h)/g*b+1)),k=l,arrForInfo[l]=m*e/(f-d)+(arrayX[0]-d)/(f-d)*c,arrForInfoY[l]?0:arrForInfoY[l]=[],arrForInfoY[l].push(b-((i[Math.floor(m/(c-1)*(i.length-1))]-h)/g*b+1)));a.strokeStyle=j,a.lineWidth=2,a.stroke(),a.beginPath()}function getClosestXsIndexes(a,b){for(var c,d,e=0;a>arrayX[e];)e++;if(c=e,void 0===b)return Math.abs(a-arrayX[e-1])<Math.abs(a-arrayX[e])?e-1:e;for(e=0;b>=arrayX[e];)e++,1e4<e;return d=e,[c,d]}function getMinimumValue(a,b,c,d){var[e,f]=getClosestXsIndexes(a,b);e=0<e?e:1;var g=Math.min.apply(Math,d.slice(e,f+1));return g}function getMaximumValue(a,b,c,d){var[e,f]=getClosestXsIndexes(a,b);e=0<e?e:1;var g=Math.max.apply(Math,d.slice(e,f+1));return g}function changeGraphicVerticalDiapason(a,b,c,d){return 0==arrayX.length?void alert("First you need to create a data array!\nLoad data and push \"Go! \""):void showGraphic(a,b,c,d)}function changeGraphicVerticalDiapasonChangeable(){max=maxYvalue,showGraphic(max,0,0)}function changeLeftRightX(a,b,c,d){0==arrayX.length||showGraphic(a,b,c,d,ordinatArrays[0],"graphic")}function showRectangle(a,b,c,d){if(0!=arrayX.length){var e=document.getElementById("glassForGraphic"),f=e.getContext("2d"),g=document.getElementById("glassForGraphic").width,h=document.getElementById("glassForGraphic").height;if(!c&&0!==c)var c=window.arrayX[0];if(!d&&0!==d)var d=arrayX[arrayX.length-1];if(!b)var i=0;else var i=b;if(!a)var j=Math.max.apply(Math,arrayY);else var j=a;if(c-d&&j-i){var k,l,m,n,o=currentRightX-currentLeftX,p=currentMax-currentMin;k=(c-currentLeftX)/o*g,l=(d-currentLeftX)/o*g,m=(i-currentMin)/p*h,n=(j-currentMin)/p*h;n=h-n,setTimeout(changeLeftRightX,0,maxYvalue,minYvalue,leftXvalue,rightXvalue),setTimeout(redraw,0)}}}function yBlackLinesStep(a){a=+a;var b=1;0>a&&(a*=-1);var c=a;if(c&&c!==1/0&&c!==-Infinity){for(;1>c;)b*=10,c*=10;for(;10<=c;)b/=10,c/=10;1<=c&&3>=c&&(b*=5,c*=5);Math.floor(a*b);return 1/b}}function precision(a){var b=0;if(0>a&&(a*=-1),!!a){for(;1>a;)a*=10,b++;return b}}function redraw(){document.getElementById("glassForGraphic").width=document.getElementById("glassForGraphic").width}var canvasLive,contextLive,firstCanvasX,secondCanvasX,canvasGraph,canvasScope,contextLiveGraph,contextScopeLive,firstScopeCanvasX,secondScopeCanvasX,canvasGraphX;window.onload=function(){function a(a,b){var c=a.getBoundingClientRect();return{x:b.touches[0].clientX-c.left,y:b.touches[0].clientY-c.top}}function b(b){b.addEventListener("touchstart",function(c){mousePos=a(b,c);var d=c.touches[0],e=new MouseEvent("mousedown",{clientX:d.clientX,clientY:d.clientY});b.dispatchEvent(e)},!1),b.addEventListener("touchend",function(){var a=new MouseEvent("mouseup",{});b.dispatchEvent(a)},!1),b.addEventListener("touchmove",function(a){var c=a.touches[0],d=new MouseEvent("mousemove",{clientX:c.clientX,clientY:c.clientY});b.dispatchEvent(d)},!1)}canvasGraph=document.getElementById("glassForGraphic"),contextLiveGraph=canvasGraph.getContext("2d"),canvasScope=document.getElementById("summaryGlassForGraphic"),contextLiveScope=canvasScope.getContext("2d"),canvasScope.onmousedown=startScopeDrawing,canvasGraph.onmousedown=startInfoDrawing,canvasScope.onmouseup=stopScopeDrawing,canvasGraph.onmouseup=stopInfoDrawing,window.onmouseup=(()=>stopScopeDrawing(),stopInfoDrawing()),canvasScope.onmousemove=drawScope,canvasGraph.onmousemove=drawInfo,setFullScreen(),b(canvasScope),b(canvasGraph),addButtons(),document.getElementById("colorMode").addEventListener("click",colorMode,!1),setFullScreen()},window.addEventListener("resize",setFullScreen,!1);var isScopeDrawing=!1,isInfoDrawing=!1;let frameOffset=null;function startScopeDrawing(a){isScopeDrawing=!0;let b=a.pageX-canvasScope.offsetLeft,c=!!(firstScopeCanvasX<secondScopeCanvasX);if(!firstScopeCanvasX||b<(c?firstScopeCanvasX-5:secondScopeCanvasX-5)||b>(c?secondScopeCanvasX+5:firstScopeCanvasX+5))firstScopeCanvasX=a.pageX-canvasScope.offsetLeft,frameOffset=null;else if(c?b>firstScopeCanvasX-5&&b<firstScopeCanvasX+5:b>secondScopeCanvasX-5&&b<secondScopeCanvasX+5)c&&(firstScopeCanvasX=secondScopeCanvasX),frameOffset=null;else if(c?b>secondScopeCanvasX-5&&b<secondScopeCanvasX+5:b>firstScopeCanvasX-5&&b<firstScopeCanvasX+5)c||(firstScopeCanvasX=secondScopeCanvasX),frameOffset=null;else if(b>(c?firstScopeCanvasX+5:secondScopeCanvasX+5)&&b<(c?secondScopeCanvasX-5:firstScopeCanvasX-5)){if(!c){let[c,a]=[firstScopeCanvasX,secondScopeCanvasX];firstScopeCanvasX=a,secondScopeCanvasX=c}frameOffset=[b-firstScopeCanvasX,secondScopeCanvasX-b]}}function startInfoDrawing(a){isInfoDrawing=!0,drawInfo(a)}function drawScope(a,b,c){if(!0==isScopeDrawing){isMagnified=!0;var d;d=justRedraw?savedBottomGraphMouseXstart:a.pageX-canvasScope.offsetLeft,savedBottomGraphMouseXstart=d,d<0+canvasScope.width/200&&(d=0+canvasScope.width/200),d>199*canvasScope.width/200&&(d=199*canvasScope.width/200),contextLiveScope.fillStyle="grey",contextLiveScope.fillRect(0,0,canvasScope.width,canvasScope.height),contextLiveScope.fillStyle="#000";let e=d>firstScopeCanvasX?1:-1;frameOffset?(contextLiveScope.fillRect(d-frameOffset[0]-canvasScope.width/200*e,0,frameOffset[0]+frameOffset[1]+canvasScope.width/100*e,canvasScope.height),contextLiveScope.clearRect(d-frameOffset[0],0+canvasScope.height/20,frameOffset[0]+frameOffset[1],canvasScope.height-canvasScope.height/10),secondScopeCanvasX=justRedraw?savedBottomGraphMouseXend:a.pageX-canvasScope.offsetLeft,savedBottomGraphMouseXend=secondScopeCanvasX,firstScopeCanvasX=d-frameOffset[0],secondScopeCanvasX=d+frameOffset[1],secondScopeCanvasX<0+canvasScope.width/200&&(secondScopeCanvasX=0+canvasScope.width/200),secondScopeCanvasX>199*canvasScope.width/200&&(secondScopeCanvasX=199*canvasScope.width/200)):(contextLiveScope.fillRect(firstScopeCanvasX-canvasScope.width/200*e,0,d-firstScopeCanvasX+canvasScope.width/100*e,canvasScope.height),contextLiveScope.clearRect(firstScopeCanvasX,0+canvasScope.height/20,d-firstScopeCanvasX,canvasScope.height-canvasScope.height/10),secondScopeCanvasX=justRedraw?savedBottomGraphMouseXend:a.pageX-canvasScope.offsetLeft,savedBottomGraphMouseXend=secondScopeCanvasX,secondScopeCanvasX<0+canvasScope.width/200&&(secondScopeCanvasX=0+canvasScope.width/200),secondScopeCanvasX>199*canvasScope.width/200&&(secondScopeCanvasX=199*canvasScope.width/200)),leftXvalue=allLeftX+(firstScopeCanvasX<secondScopeCanvasX?firstScopeCanvasX:secondScopeCanvasX)/canvasScope.width*(allRightX-allLeftX),rightXvalue=allLeftX+(firstScopeCanvasX>secondScopeCanvasX?firstScopeCanvasX:secondScopeCanvasX)/canvasScope.width*(allRightX-allLeftX);let f=[],g=[];c&&(ordinatArrays=allGraphsInGroup.columns.slice(1).map(a=>a.slice(1)));for(let a=0;a<ordinatArrays.length;a++)f.push(getMaximumValue(leftXvalue,rightXvalue,"nothing",ordinatArrays[a])),g.push(getMinimumValue(leftXvalue,rightXvalue,"nothing",ordinatArrays[a]));maxYvalue=Math.max(...f),minYvalue=Math.min(...g);let h=maxYvalue-minYvalue;if(maxYvalue+=.01*h,minYvalue-=.01*h,saveScopeTopBottom=[maxYvalue,minYvalue],c)return[maxYvalue,minYvalue];b&&([maxYvalue,minYvalue]=b),showRectangle(maxYvalue,minYvalue,leftXvalue,rightXvalue)}}function drawInfo(a){if(!0==isInfoDrawing){canvasGraphX=a.pageX-canvasGraph.offsetLeft,canvasGraphY=a.pageY-canvasGraph.offsetTop,document.getElementById("glassForGraphic").width=document.getElementById("glassForGraphic").width;var b=canvasGraphX;b<0+canvasGraph.width/200&&(b=0+canvasGraph.width/200),b>199*canvasGraph.width/200&&(b=199*canvasGraph.width/200);canvasGraphY;contextLiveGraph.fillStyle="#999",leftXvalue===void 0&&(leftXvalue=allLeftX,rightXvalue=allRightX);let c=isMagnified?leftXvalue+b/canvasGraph.width*(rightXvalue-leftXvalue):leftXvalue+1.04*(b/canvasGraph.width*(rightXvalue-leftXvalue))-.02*(rightXvalue-leftXvalue);let d=getClosestXsIndexes(c);c=arrForInfo[d];let e,f,g,h;e=80,f=80,g=20,h=80,2<allGraphsInGroup.columns.slice(1).length&&(h*=1.5),contextLiveGraph.clearRect(0,0,canvasGraph.width,canvasGraph.height);let j=[];for(let a=0;a<ordinatArrays.length;a++)j.push(+arrForInfoY[d][a]);let k=Math.min(...j);contextLiveGraph.fillRect(c-1,k,2,canvasGraph.height);let l=[];for(let a=0;a<checksArr.length;a++)checksArr[a]&&l.push(a);for(let a=0;a<ordinatArrays.length;a++)drawInfoCircle(d,c,a,allGraphsInGroup.colors[`y${l[a]}`]);contextLiveGraph.strokeStyle="grey";let m=canvasGraph.width/2,n=m-e,o=m+f,p=n+(e+f)/2,q=0+g,r=q+h,s=q+h/2;drawBox(contextLiveGraph,"#fff",n,o,p,q,r,s,c,d)}}function drawInfoCircle(a,b,c,d){contextLiveGraph.beginPath(),contextLiveGraph.arc(b,arrForInfoY[a][c],4,0,2*Math.PI),contextLiveGraph.stroke();let e=document.documentElement.style.backgroundColor;e=e?e:"#fff",contextLiveGraph.fillStyle=e,contextLiveGraph.fill(),contextLiveGraph.lineWidth=2,contextLiveGraph.strokeStyle=d,contextLiveGraph.stroke()}function drawInfoOnGraph(){}function drawBox(a,b,c,d,e,f,g,h,i,j){let k=document.documentElement.style.backgroundColor;k=k?k:"#fff",a.fillStyle=k,a.beginPath(),a.moveTo(c,h),a.bezierCurveTo(c,f,c,f,e,f),a.bezierCurveTo(d,f,d,f,d,h),a.bezierCurveTo(d,g,d,g,e,g),a.bezierCurveTo(c,g,c,g,c,h),a.stroke(),a.fill(),a.fillStyle="grey",a.font="bold 18px Georgia sans-serif";let l=new Date(+arrayX[j]).toLocaleString("en-US",{weekday:"short",month:"short",day:"numeric"});a.fillText(l,c+40,f+20,80),a.fillStyle="#F00",a.font="bold 20px Georgia sans-serif";let m=[];for(let k=0;k<checksArr.length;k++)checksArr[k]&&m.push(k);for(let k=0;k<ordinatArrays.length;k++)currentColor=allGraphsInGroup.colors[`y${m[k]}`],drawAllData(m[k],a,j,c,10,(d-c)/2+10,f,d,currentColor,k,ordinatArrays.length)}function drawAllData(a,b,c,d,e,f,g,h,i,j,k){let l;colIndent=j%2?f:e;let m=2;1<j&&(m++,m++),1==k&&(l=8*(""+ordinatArrays[j][c]).length,colIndent=(h-d-l)/2),b.fillStyle=i,dataText=ordinatArrays[j][c],b.fillText(dataText,d+colIndent,g+20*m,(h-d)/2-2*e),m++,1==k&&(l=8*allGraphsInGroup.names[`y${a}`].length,colIndent=(h-d-l)/2),dataText=allGraphsInGroup.names[`y${a}`],b.fillText(dataText,d+colIndent,g+20*m,(h-d)/2-2*e)}function stopScopeDrawing(){isScopeDrawing=!1}function stopInfoDrawing(){isInfoDrawing=!1,document.getElementById("glassForGraphic").width=document.getElementById("glassForGraphic").width}function setFullScreen(){document.getElementById("graphic").width=document.getElementById("forGraphic").clientWidth,document.getElementById("graphic").height=document.getElementById("graphic").width/3.5,document.getElementById("glassForGraphic").width=document.getElementById("forGraphic").clientWidth,document.getElementById("glassForGraphic").height=document.getElementById("glassForGraphic").width/3.5,document.getElementById("summaryGraphic").width=document.getElementById("forGraphic").nextElementSibling.clientWidth,document.getElementById("summaryGraphic").height=document.getElementById("summaryGraphic").width/14,document.getElementById("summaryGlassForGraphic").width=document.getElementById("forGraphic").nextElementSibling.clientWidth,document.getElementById("summaryGlassForGraphic").height=document.getElementById("summaryGlassForGraphic").width/14,buildGraphic()}function addButtons(){let a=1;document.getElementById("buttons")&&document.getElementById("buttons").parentElement.removeChild(document.getElementById("buttons"));let b=document.createElement("div");for(let c in b.id="buttons",document.getElementById("container").insertBefore(b,document.getElementById("colorMode").parentElement),allGraphsInGroup.colors)buttonAdd(allGraphsInGroup.names[c],a),styleAdd(allGraphsInGroup.colors[c],a),a++}function colorMode(){let a=document.getElementById("colorMode"),b=document.documentElement,c=document.getElementsByClassName("inputGroup");if(a.innerText=`Switch to ${"Day"==a.innerText.split(" ")[2]?"Nigth":"Day"} Mode`,""==b.style.backgroundColor){b.style.backgroundColor="#212121";for(let a=0;a<c.length;a++)c[a].children[1].style.color="#fff"}else if(b.style.backgroundColor="",c[0].children[1].getAttribute("style"))for(let a=0;a<c.length;a++)c[a].children[1].removeAttribute("style")}function buttonAdd(a,b){let c=document.createElement("div");c.className="inputGroup";let d=document.createElement("input");d.id=`option${b}`,d.name=`option${b}`,d.type="checkbox",d.checked=!0,d.setAttribute("onclick","changeGraphsInGroup()");let e=document.createElement("label");e.innerText=a,e.setAttribute("for",`option${b}`),c.appendChild(d),c.appendChild(e),document.getElementById("buttons").appendChild(c)}function styleAdd(a,b){let c=document.createElement("style");c.innerText=`.inputGroup input:checked ~ label[for=option${b}]:after {\nbackground-color: ${a};\nborder-color: ${a};\n}`,document.getElementById("buttons").appendChild(c)}function changeGraphsInGroup(a){a||(oldAllGraphsInGroup=Object.assign({},allGraphsInGroup),oldChecksArr=checksArr),checksArr=[];let b=document.querySelectorAll(".inputGroup");if(0==b.length)return allGraphsInGroup=data[radioSelect()],void(checksArr=[!0,!0,!0,!0]);for(let c=0;c<b.length;c++)checksArr.push(b[c].firstChild.checked);for(let b in allGraphsInGroup={},reallyAllGraphsInGroup=data[radioSelect()],reallyAllGraphsInGroup)if(!Array.isArray(reallyAllGraphsInGroup[b])){let a=0;for(let c in allGraphsInGroup[b]={},reallyAllGraphsInGroup[b])(checksArr[a]||"x"==c)&&(allGraphsInGroup[b][c]=reallyAllGraphsInGroup[b][c]),a++}else{allGraphsInGroup[b]=[];for(let a=0;a<reallyAllGraphsInGroup[b].length;a++)(0==a||checksArr[a-1])&&allGraphsInGroup[b].push(reallyAllGraphsInGroup[b][a])}if(!a){let a,b,c,d,e,f,g,h,j=10,k=250/10,l=saveTopBottom[0],m=saveTopBottom[1],n=isMagnified;if(isMagnified?(a=buildGraphic(!1,!0),[e,f]=saveScopeTopBottom,justRedraw=!0,isScopeDrawing=!0,b=drawScope(!1,!1,!0),justRedraw=!1,isScopeDrawing=!1,[c,d]=b,g=(c-e)/10,h=(d-f)/10):a=buildGraphic(!1,!0),isMagnified=n,!oldAllGraphsInGroup)return;allGraphsInGroup=oldAllGraphsInGroup,checksArr=oldChecksArr;let[o,p]=a;if(o==l&&p==m&&c==e&&d==f)return void changeGraphsInGroup(!0);let q=(o-l)/10,r=(p-m)/10;if(isMagnified){for(let a=1;a<=j;a++)setTimeout(buildGraphic,k*a,...[1,0,l+q*a,m+r*a]);justRedraw=!0,isScopeDrawing=!0;for(let a=1;a<=j;a++)setTimeout(drawScope,k*a,"nothing",[e+g*a,f+h*a]);setTimeout(()=>{justRedraw=!1,isScopeDrawing=!1},11*k)}else for(let a=1;a<=j;a++)setTimeout(buildGraphic,k*a,...[0,0,l+q*a,m+r*a]);return void setTimeout(changeGraphsInGroup,11*k,!0)}isMagnified?(buildGraphic(!0),justRedraw=!0,isScopeDrawing=!0,drawScope(),justRedraw=!1,isScopeDrawing=!1):buildGraphic()}function topButtonClick(a){isMagnified=!1,allGraphsInGroup=data[radioSelect()],addButtons(),changeGraphsInGroup(a),document.getElementById("summaryGlassForGraphic").width=document.getElementById("summaryGlassForGraphic").width}